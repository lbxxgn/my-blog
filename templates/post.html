{% extends "base.html" %}

{% block title %}{{ post.title }} - 我的博客{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/share.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <article class="post-full">
        <div class="post-content">
            {{ post.content_html|safe }}
        </div>

        {% if post.tags %}
        <div class="post-tags">
            {% for tag in post.tags %}
            <a href="{{ url_for('view_tag', tag_id=tag.id) }}" class="post-tag">#{{ tag.name }}</a>
            {% endfor %}
        </div>
        {% endif %}
    </article>

    <!-- Share Buttons -->
    <div class="share-buttons">
        <a href="https://service.weibo.com/share/share.php?url={{ request.url_external }}&title={{ post.title }}"
           class="share-btn weibo"
           target="_blank"
           rel="noopener">
            分享到微博
        </a>
        <button class="share-btn wechat">分享到微信</button>
        <button class="share-btn copy">复制链接</button>
    </div>

    <!-- QR Code Modal -->
    <div class="modal-overlay">
        <div class="modal-content">
            <h3>微信扫码分享</h3>
            <img src="" alt="QR Code" class="qrcode-img">
            <button class="btn btn-sm modal-close">关闭</button>
        </div>
    </div>

    <div class="copy-toast">链接已复制</div>

    <!-- Comments Section -->
    <section class="comments-section">
        <h3>评论 ({{ comments|length }})</h3>

        {% if comments %}
        <div class="comments-list">
            {% for comment in comments %}
            <div class="comment">
                <div class="comment-header">
                    <strong>{{ comment.author_name }}</strong>
                    <span class="comment-date">{{ comment.created_at[:16].replace('T', ' ') }}</span>
                </div>
                <div class="comment-content">
                    {{ comment.content }}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-comments">暂无评论，快来抢沙发吧！</p>
        {% endif %}

        <!-- Comment Form -->
        <form class="comment-form" action="{{ url_for('add_comment', post_id=post.id) }}" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <h4>发表评论</h4>
            <div class="form-group">
                <label for="author_name">姓名 *</label>
                <input type="text" name="author_name" id="author_name" required maxlength="50">
            </div>
            <div class="form-group">
                <label for="author_email">邮箱（可选，不会公开）</label>
                <input type="email" name="author_email" id="author_email" maxlength="100">
            </div>
            <div class="form-group">
                <label for="content">评论内容 *</label>
                <textarea name="content" id="content" rows="5" required maxlength="1000"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">提交评论</button>
        </form>
    </section>

    <div class="post-navigation">
        <a href="{{ url_for('index') }}" class="back-link">← 返回首页</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/share.js') }}"></script>
{% endblock %}
