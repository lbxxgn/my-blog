{% extends "base.html" %}

{% block title %}
{% if post %}编辑文章 - {{ post.title }}{% else %}新建文章{% endif %} - 我的博客
{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/quill.css') }}">
{% endblock %}

{% block content %}
<div class="container admin-editor">
    <h2>{% if post %}编辑文章{% else %}新建文章{% endif %}</h2>

    <form method="POST" class="editor-form" id="editorForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <div class="form-group">
            <label for="title">标题</label>
            <input type="text" id="title" name="title" value="{% if post %}{{ post.title }}{% endif %}" required>
        </div>

        <div class="form-group">
            <label for="category_id">分类</label>
            <select id="category_id" name="category_id">
                <option value="">无分类</option>
                {% for category in categories %}
                <option value="{{ category.id }}"
                    {% if post and post.category_id == category.id %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="tags">标签（用逗号分隔）</label>
            <input type="text" name="tags" id="tags" value="{% if post and post.tags %}{{ post.tags|map(attribute='name')|join(', ') }}{% endif %}" placeholder="例如: Python, Flask, Web">
            <small style="color: #666;">多个标签用逗号分隔</small>
        </div>

        <div class="form-group">
            <label for="content">内容</label>
            <textarea id="content" name="content" rows="20" required>{% if post %}{{ post.content }}{% endif %}</textarea>
            <!-- Hidden file input for image upload -->
            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
            <div id="saveStatus" class="save-status"></div>
        </div>

        <div class="form-actions">
            <input type="checkbox" name="is_published" id="is_published" {% if post and post.is_published %}checked{% endif %} style="display: none;">
            {% if not post or not post.is_published %}
            <button type="button" id="publishToggle" class="btn btn-outline" onclick="togglePublish()">立即发布</button>
            {% endif %}
            <button type="submit" class="btn btn-primary">保存</button>
            <a href="{{ url_for('admin_dashboard') }}" class="btn">取消</a>
        </div>
    </form>
</div>

<!-- Link Quill CSS from CDN -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
{% endblock %}

{% block scripts %}
<!-- Load Quill from CDN -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="{{ url_for('static', filename='js/quill-editor.js') }}?v=1.0"></script>
{% endblock %}
