{% extends "base.html" %}

{% block title %}æ•°æ®å¯¼å…¥ - ç®¡ç†åå°{% endblock %}

{% block content %}
<div class="container admin-dashboard">
    <div class="dashboard-header">
        <h2>æ•°æ®å¯¼å…¥</h2>
        <div class="header-actions">
            <a href="{{ url_for('export_page') }}" class="btn">æ•°æ®å¯¼å‡º</a>
            <a href="{{ url_for('admin_dashboard') }}" class="btn">è¿”å›ç®¡ç†åå°</a>
        </div>
    </div>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="import-section">
        <h3>å¯¼å…¥é€‰é¡¹</h3>
        <p class="text-secondary">é€‰æ‹©è¦å¯¼å…¥çš„æ–‡ä»¶æ ¼å¼ï¼Œæ”¯æŒä»ä¹‹å‰å¯¼å‡ºçš„æ•°æ®ä¸­æ¢å¤æ–‡ç« ã€‚</p>

        <div class="import-options">
            <!-- JSON Import -->
            <div class="import-option-card">
                <div class="import-icon">ğŸ“¦</div>
                <div class="import-info">
                    <h4>ä» JSON æ–‡ä»¶å¯¼å…¥</h4>
                    <p>å¯¼å…¥ä¹‹å‰å¯¼å‡ºçš„ JSON å¤‡ä»½æ–‡ä»¶ï¼Œæ¢å¤æ‰€æœ‰æ–‡ç« ã€åˆ†ç±»å’Œæ ‡ç­¾</p>
                    <ul class="import-features">
                        <li>âœ“ å®Œæ•´çš„æ•°æ®åº“ç»“æ„</li>
                        <li>âœ“ ä¿ç•™åŸå§‹å‘å¸ƒæ—¥æœŸ</li>
                        <li>âœ“ è‡ªåŠ¨åˆ›å»ºåˆ†ç±»å’Œæ ‡ç­¾</li>
                        <li>âœ“ æ™ºèƒ½è·³è¿‡é‡å¤æ–‡ç« </li>
                    </ul>
                </div>
                <div class="import-action">
                    <form action="{{ url_for('import_json') }}" method="post" enctype="multipart/form-data" class="import-form">
                        <input type="file" name="import_file" accept=".json" id="jsonFileInput" required>
                        <label for="jsonFileInput" class="file-label">é€‰æ‹© JSON æ–‡ä»¶</label>
                        <button type="submit" class="btn btn-primary">å¯¼å…¥ JSON</button>
                    </form>
                </div>
            </div>

            <!-- Markdown Import -->
            <div class="import-option-card">
                <div class="import-icon">ğŸ“</div>
                <div class="import-info">
                    <h4>ä» Markdown æ–‡ä»¶å¯¼å…¥</h4>
                    <p>å¯¼å…¥åŒ…å« YAML frontmatter çš„ Markdown æ–‡ä»¶ï¼ˆéœ€æ‰“åŒ…ä¸º ZIPï¼‰</p>
                    <ul class="import-features">
                        <li>âœ“ æ”¯æŒæ ‡å‡† frontmatter æ ¼å¼</li>
                        <li>âœ“ æ‰¹é‡å¯¼å…¥å¤šä¸ªæ–‡ä»¶</li>
                        <li>âœ“ ä¿ç•™åˆ†ç±»å’Œæ ‡ç­¾</li>
                        <li>âœ“ è‡ªåŠ¨è¯†åˆ«æ–‡ç« å…ƒæ•°æ®</li>
                    </ul>
                </div>
                <div class="import-action">
                    <form action="{{ url_for('import_markdown') }}" method="post" enctype="multipart/form-data" class="import-form">
                        <input type="file" name="import_file" accept=".zip" id="markdownFileInput" required>
                        <label for="markdownFileInput" class="file-label">é€‰æ‹© ZIP æ–‡ä»¶</label>
                        <button type="submit" class="btn btn-primary">å¯¼å…¥ Markdown</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Import Info -->
        <div class="import-info-box">
            <h4>ğŸ“Œ å¯¼å…¥è¯´æ˜</h4>
            <ul>
                <li><strong>JSON æ ¼å¼</strong>ï¼šä½¿ç”¨ç³»ç»Ÿå¯¼å‡ºåŠŸèƒ½ç”Ÿæˆçš„ JSON æ–‡ä»¶</li>
                <li><strong>Markdown æ ¼å¼</strong>ï¼šå°†å¯¼å‡ºçš„ Markdown æ–‡ä»¶æ‰“åŒ…æˆ ZIP ä¸Šä¼ </li>
                <li>å¯¼å…¥æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹é‡å¤æ–‡ç« ï¼ˆé€šè¿‡æ ‡é¢˜å’Œæ—¥æœŸï¼‰</li>
                <li>ä¸å­˜åœ¨çš„åˆ†ç±»å’Œæ ‡ç­¾ä¼šè‡ªåŠ¨åˆ›å»º</li>
                <li>æ–‡ç« çš„ä½œè€…å°†è®¾ç½®ä¸ºå½“å‰ç™»å½•çš„ç®¡ç†å‘˜</li>
            </ul>
        </div>

        <!-- Import Warnings -->
        <div class="import-warning-box">
            <h4>âš ï¸ æ³¨æ„äº‹é¡¹</h4>
            <ul>
                <li>å¯¼å…¥æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·ç¡®ä¿å¤‡ä»½é‡è¦æ•°æ®</li>
                <li>é‡å¤çš„æ–‡ç« ä¼šè¢«è‡ªåŠ¨è·³è¿‡</li>
                <li>å¦‚æœæ–‡ç« æ•°é‡è¾ƒå¤šï¼Œå¯¼å…¥å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´</li>
                <li>å»ºè®®åœ¨å¯¼å…¥å‰å…ˆæ¸…ç©ºæµ‹è¯•æ•°æ®</li>
            </ul>
        </div>

        <!-- Export First Info -->
        <div class="export-first-info">
            <h4>ğŸ’¡ è¿˜æ²¡æœ‰å¯¼å‡ºæ–‡ä»¶ï¼Ÿ</h4>
            <p>å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæ‚¨å¯ä»¥å…ˆå¯¼å‡ºç°æœ‰æ•°æ®ï¼š</p>
            <a href="{{ url_for('export_page') }}" class="btn">å‰å¾€æ•°æ®å¯¼å‡º</a>
        </div>
    </div>
</div>

<style>
.import-section {
    max-width: 1000px;
    margin: 0 auto;
}

.import-section h3 {
    margin-bottom: 1rem;
    color: var(--text-color, #1f2937);
}

.import-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin: 2rem 0;
}

.import-option-card {
    background: var(--card-bg, #fff);
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    transition: all 0.2s;
}

.import-option-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transform: translateY(-2px);
}

.import-icon {
    font-size: 2.5rem;
    margin-bottom: 1rem;
}

.import-info {
    flex: 1;
}

.import-info h4 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    color: var(--text-color, #1f2937);
}

.import-info p {
    color: var(--text-secondary, #6b7280);
    margin-bottom: 1rem;
    line-height: 1.6;
}

.import-features {
    list-style: none;
    padding: 0;
    margin: 0 0 1rem 0;
}

.import-features li {
    color: var(--text-secondary, #6b7280);
    font-size: 0.9rem;
    padding: 0.25rem 0;
}

.import-action {
    margin-top: 1rem;
}

.import-form {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.import-form input[type="file"] {
    display: none;
}

.file-label {
    display: block;
    padding: 0.5rem 1rem;
    background: var(--code-bg, #f3f4f6);
    border: 2px dashed var(--border-color, #d1d5db);
    border-radius: 8px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    color: var(--text-secondary, #6b7280);
}

.file-label:hover {
    border-color: var(--primary-color, #10b981);
    color: var(--primary-color, #10b981);
}

.import-form input[type="file"]:checked + .file-label {
    border-color: var(--primary-color, #10b981);
    background: var(--primary-bg, #d1fae5);
}

.import-action .btn {
    width: 100%;
}

.import-info-box,
.import-warning-box {
    background: var(--card-bg, #fff);
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
}

.import-warning-box {
    background: #fef3c7;
    border-color: #f59e0b;
}

.import-warning-box h4 {
    color: #92400e;
    margin: 0 0 1rem 0;
}

.import-warning-box ul li {
    color: #92400e;
}

.import-info-box h4,
.import-warning-box h4 {
    margin: 0 0 1rem 0;
    font-size: 1.1rem;
}

.import-info-box ul,
.import-warning-box ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.import-info-box li,
.import-warning-box li {
    padding: 0.5rem 0;
    color: var(--text-secondary, #6b7280);
    line-height: 1.6;
}

.import-info-box code,
.import-warning-box code {
    padding: 0.25rem 0.5rem;
    background: var(--code-bg, #f3f4f6);
    border-radius: 4px;
    font-size: 0.875rem;
    font-family: 'Courier New', monospace;
}

.export-first-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 1.5rem 0;
    text-align: center;
}

.export-first-info h4 {
    margin: 0 0 0.5rem 0;
    color: white;
}

.export-first-info p {
    margin: 0.5rem 0 1rem 0;
    opacity: 0.9;
}

.export-first-info .btn {
    background: white;
    color: #667eea;
    border: none;
}

.export-first-info .btn:hover {
    background: #f0f0f0;
}

/* Flash messages */
.flash-messages {
    margin-bottom: 1.5rem;
}

.flash-message {
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 0.75rem;
    animation: slideIn 0.3s ease-out;
}

.flash-message.success {
    background: var(--success-bg, #d1fae5);
    color: var(--success-color, #065f46);
    border: 1px solid var(--success-border, #10b981);
}

.flash-message.error {
    background: var(--error-bg, #fee2e2);
    color: var(--error-color, #991b1b);
    border: 1px solid var(--error-border, #ef4444);
}

.flash-message.warning {
    background: #fef3c7;
    color: #92400e;
    border: 1px solid #f59e0b;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Dark theme */
.dark-theme .import-option-card {
    background: #1f2937;
    border-color: #374151;
}

.dark-theme .import-info h4 {
    color: #f9fafb;
}

.dark-theme .file-label {
    background: #374151;
    border-color: #4b5563;
    color: #d1d5db;
}

.dark-theme .file-label:hover {
    border-color: #10b981;
    color: #10b981;
}

.dark-theme .import-info-box {
    background: #1f2937;
    border-color: #374151;
}

.dark-theme .import-warning-box {
    background: #451a03;
    border-color: #92400e;
}

.dark-theme .import-warning-box h4 {
    color: #fef3c7;
}

.dark-theme .import-warning-box li {
    color: #fef3c7;
}

.dark-theme .import-info-box code,
.dark-theme .import-warning-box code {
    background: #374151;
    color: #f9fafb;
}

/* Responsive */
@media (max-width: 768px) {
    .import-options {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// Update file label when file is selected
document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', function(e) {
        const label = this.nextElementSibling;
        const fileName = e.target.files[0]?.name;

        if (fileName) {
            label.textContent = `å·²é€‰æ‹©: ${fileName}`;
            label.style.borderColor = 'var(--primary-color, #10b981)';
            label.style.background = 'var(--primary-bg, #d1fae5)';
            label.style.color = 'var(--primary-color, #10b981)';
        }
    });
});
</script>
{% endblock %}
