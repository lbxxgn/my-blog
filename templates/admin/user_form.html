{% extends "base.html" %}

{% block title %}
{% if user %}编辑用户 - {{ user.username }}{% else %}新建用户{% endif %} - 我的博客
{% endblock %}

{% block content %}
<div class="container" style="max-width: 600px; margin: 2rem auto;">
    <div class="form-container">
        <h2>{% if user %}编辑用户{% else %}新建用户{% endif %}</h2>

        <form method="POST">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

            <div class="form-group">
                <label for="username">用户名 *</label>
                <input type="text" name="username" id="username" required
                       value="{{ user.username if user else '' }}" maxlength="50">
            </div>

            {% if not user %}
            <div class="form-group">
                <label for="password">密码 *</label>
                <input type="password" name="password" id="password" required minlength="10">
                <small style="color: var(--text-secondary, #666);">密码至少10位，包含大小写字母和数字</small>
            </div>
            {% endif %}

            <div class="form-group">
                <label for="display_name">显示名称</label>
                <input type="text" name="display_name" id="display_name"
                       value="{{ user.display_name if user else '' }}" maxlength="100">
                <small style="color: var(--text-secondary, #666);">用于在前端显示的名称（可选）</small>
            </div>

            <div class="form-group">
                <label for="role">角色 *</label>
                <select name="role" id="role" required>
                    <option value="author" {% if not user or user.role == 'author' %}selected{% endif %}>作者</option>
                    <option value="editor" {% if user and user.role == 'editor' %}selected{% endif %}>编辑</option>
                    <option value="admin" {% if user and user.role == 'admin' %}selected{% endif %}>管理员</option>
                </select>
                <small style="color: var(--text-secondary, #666);">
                    <strong>作者</strong>：只能管理自己的文章<br>
                    <strong>编辑</strong>：可以管理所有文章和评论，但不能删除文章<br>
                    <strong>管理员</strong>：完全权限
                </small>
            </div>

            <div class="form-group">
                <label for="bio">个人简介</label>
                <textarea name="bio" id="bio" rows="4" maxlength="500">{{ user.bio if user else '' }}</textarea>
            </div>

            {% if user %}
            <div class="form-group">
                <label>
                    <input type="checkbox" name="is_active" value="1" {% if user.is_active %}checked{% endif %}>
                    账户启用
                </label>
            </div>
            {% endif %}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    {% if user %}保存修改{% else %}创建用户{% endif %}
                </button>
                <a href="{{ url_for('user_list') }}" class="btn">取消</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
