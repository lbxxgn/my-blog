{% extends "base.html" %}

{% block title %}
{% if category %}{{ category.name }} - {% endif %}È¶ñÈ°µ - ÊàëÁöÑÂçöÂÆ¢
{% endblock %}

{% block content %}
<div class="container main-layout">
    <div class="content-wrapper">
        <div class="main-content">
            {% if categories %}
            <div class="category-filter">
                <a href="{{ url_for('index') }}" class="category-link {% if not category %}active{% endif %}">ÂÖ®ÈÉ®</a>
                {% for cat in categories %}
                    <a href="{{ url_for('view_category', category_id=cat.id) }}"
                       class="category-link {% if category and category.id == cat.id %}active{% endif %}">
                        {{ cat.name }}
                    </a>
                {% endfor %}
            </div>
            {% endif %}

            {% if posts %}
                <div id="posts-container" class="posts-list">
                    {% for post in posts %}
                        <a href="{{ url_for('view_post', post_id=post.id) }}" class="post-card-link">
                            <article class="post-card">
                                <h2>{{ post.title }}</h2>
                                <div class="post-meta">
                                    {% if post.category_name %}
                                    <span class="post-category">{{ post.category_name }}</span>
                                    <span>¬∑</span>
                                    {% endif %}
                                    {% if post.author_display_name or post.author_username %}
                                    <span class="post-author">
                                        <a href="{{ url_for('view_author', author_id=post.author_id) }}" style="color: inherit; text-decoration: none;">
                                            üë§ {{ post.author_display_name or post.author_username }}
                                        </a>
                                    </span>
                                    <span>¬∑</span>
                                    {% endif %}
                                    <time datetime="{{ post.created_at }}">{{ (post.created_at|localtime)[:10] }}</time>
                                </div>
                                <div class="post-excerpt">
                                    {{ post.content[:200] }}...
                                </div>
                            </article>
                        </a>
                    {% endfor %}
                </div>

                {% if pagination.page < pagination.total_pages %}
                <div class="load-more-container">
                    <button id="load-more" class="btn btn-primary" data-page="{{ pagination.page + 1 }}" data-category="{{ category.id if category else '' }}">
                        Âä†ËΩΩÊõ¥Â§ö
                    </button>
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <p>ËøòÊ≤°ÊúâÂèëÂ∏É‰ªª‰ΩïÊñáÁ´†„ÄÇ</p>
                </div>
            {% endif %}
        </div>

        <aside class="sidebar">
            {% if popular_tags %}
            <div class="sidebar-widget">
                <h3 class="widget-title">üî• ÁÉ≠Èó®Ê†áÁ≠æ</h3>
                <div class="popular-tags">
                    {% for tag in popular_tags %}
                    <a href="{{ url_for('view_tag', tag_id=tag.id) }}" class="popular-tag">
                        #{{ tag.name }}
                        <span class="tag-count">{{ tag.post_count }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </aside>
    </div>
</div>
{% endblock %}
